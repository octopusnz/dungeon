<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>Dungeon (Browser)</title><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body{font-family:system-ui,Arial,sans-serif;background:#101317;color:#e6e6e6;margin:0;line-height:1.35}
header{background:#181d23;padding:1rem 1.25rem;display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
h1{font-size:1.25rem;margin:0}
main{padding:1rem;max-width:1100px;margin:0 auto}
section.panel{background:#1b222b;border:1px solid #26303a;border-radius:10px;padding:0.75rem 1rem;margin-bottom:1rem}
section.panel h2{font-size:1rem;margin:0 0 .5rem 0;display:flex;justify-content:space-between;align-items:center}
button{background:#2b4b75;color:#fff;border:1px solid #355e91;border-radius:6px;font-size:.85rem;padding:.45rem .8rem;cursor:pointer;line-height:1.1}
button:hover{background:#356294}
button.danger{background:#7b2f2f;border-color:#934040}
button.danger:hover{background:#9b3c3c}
input,textarea,select{background:#141a21;color:#e6e6e6;border:1px solid #2a363f;border-radius:6px;padding:.45rem .6rem;font-size:.8rem;width:100%;box-sizing:border-box}
textarea{resize:vertical;min-height:60px}
fieldset{border:1px solid #2c3742;padding:.5rem  .75rem;border-radius:8px;margin:0 0 .75rem 0}
legend{padding:0 .4rem;font-size:.75rem;letter-spacing:.5px;color:#9cb3c9}
#inventoryItems span{display:inline-block;background:#243241;margin:2px 4px;padding:2px 6px;border-radius:4px;font-size:.7rem}
#log{background:#0f1419;border:1px solid #1f2831;border-radius:8px;padding:.6rem;font-size:.7rem;max-height:260px;overflow:auto;font-family:ui-monospace,monospace;white-space:pre-wrap}
.row{display:flex;flex-wrap:wrap;gap:.75rem}
.col{flex:1 1 260px;min-width:240px}
.currency{font-weight:600;font-size:.8rem;margin-top:.4rem}
.tag{font-size:.55rem;padding:2px 5px;border-radius:4px;background:#334257;margin-left:.4rem;letter-spacing:.5px}
.rar-Epic{background:#5a2f73}.rar-Legendary{background:#7a4d15}.rar-Rare{background:#224f8d}.rar-Uncommon{background:#375d2a}.rar-Common{background:#424d57}
table.shop{width:100%;border-collapse:collapse;font-size:.7rem}
table.shop th,table.shop td{padding:4px 6px;border-bottom:1px solid #26303a;text-align:left}
table.shop tbody tr:hover{background:#1f2831}
.inline{display:inline-flex;align-items:center;gap:.4rem;font-size:.65rem;margin-right:.75rem}
.muted{color:#94a3b8;font-size:.65rem;margin-top:.25rem}
.actions-grid{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.4rem}
/* === Fantasy Theme Overrides (appended) === */
@import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600&family=Fanwood+Text:ital@0;1&display=swap');
body{font-family:'Fanwood Text',serif;background:radial-gradient(circle at 25% 18%,rgba(110,84,42,0.15),transparent 60%),radial-gradient(circle at 82% 72%,rgba(140,95,40,0.12),transparent 70%),linear-gradient(#14181e,#0c0f14 70%);color:#ebe3d5}
header{background:linear-gradient(90deg,#1b222a,#222a33 55%,#1b222a);border-bottom:2px solid #242e37;box-shadow:0 2px 6px rgba(0,0,0,.4)}
h1{font-family:'Cinzel Decorative',cursive;font-size:1.55rem;letter-spacing:.5px;text-shadow:0 0 6px rgba(255,220,140,.25)}
section.panel{background:linear-gradient(145deg,rgba(60,46,34,0.92),rgba(30,22,18,0.92));border:1px solid #3a2f24;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,.45),inset 0 0 0 1px rgba(255,255,255,0.04);padding:.9rem 1.05rem}
section.panel h2{font:600 .95rem 'Cinzel',serif;color:#caa75b}
button{background:linear-gradient(145deg,#3f2e21,#2a2019);color:#f5e9d6;border:1px solid #4e3a2b;border-radius:8px;font:600 .78rem 'Cinzel',serif;letter-spacing:.5px;padding:.5rem .85rem}
button:hover{background:linear-gradient(145deg,#57402d,#3a2b22)}
button.danger{background:linear-gradient(145deg,#5e2323,#401515);border-color:#6d2c2c}
button.danger:hover{background:linear-gradient(145deg,#7b2f2f,#512020)}
#inventoryItems span{background:linear-gradient(145deg,#3a2b22,#281f18);border:1px solid #4e3a2b;border-radius:6px;font-size:.68rem;letter-spacing:.4px}
#log{background:#121517;border:1px solid #313a42;border-radius:10px;padding:.65rem .7rem;font-size:.67rem;max-height:300px;line-height:1.3}
.tag{font-family:'Cinzel',serif;font-size:.60rem;padding:3px 7px;border-radius:6px;min-width:52px;text-align:center}
.rar-Common{background:#55606b;color:#d2d8dd}
.rar-Uncommon{background:#2d6d39;color:#cfe9d2}
.rar-Rare{background:#1d4d8d;color:#c7ddff}
.rar-Epic{background:#6a2f82;color:#f1d4ff}
.rar-Legendary{background:#b07219;color:#ffe9c5}
</style></head><body>
<header>
	<h1>Dungeon (Browser)</h1>
	<div class="actions-grid">
		<button id="act-pick">Pickpocket</button>
		<button id="act-fight">Fight</button>
		<button id="act-shop-gen">New Shop</button>
		<button id="act-tavern">Tavern</button>
		<button id="act-reset" class="danger">Reset</button>
	</div>
</header>
<main>
	<section class="panel" id="inv-panel">
		<h2>Inventory <span id="inv-currency"></span></h2>
		<div id="inventoryItems"></div>
		<div class="muted" id="luck-ind"></div>
	</section>
	<div class="row">
		<div class="col">
			<section class="panel">
				<h2>Pickpocket</h2>
				<div class="muted" id="pp-info">Random candidate loot is generated each attempt. Stored luck boosts chance of a special event.</div>
				<button id="pp-run">Pickpocket</button>
			</section>
			<section class="panel">
				<h2>Loot Input</h2>
				<input id="loot-input" placeholder="e.g. 3 gp and a silver ring" />
				<div class="actions-grid">
					<button id="loot-add">Add Loot</button>
					<button id="penalty-apply">Apply 7% Penalty</button>
				</div>
			</section>
			<section class="panel" id="tavern-panel" style="display:none">
				<h2>Tavern</h2>
				<div class="actions-grid">
					<button data-tv="drink">Drink</button>
					<button data-tv="food">Food</button>
					<button data-tv="stay">Stay</button>
					<button data-tv="tip">Tip</button>
					<button data-tv="flirt">Flirt</button>
				</div>
			</section>
		</div>
		<div class="col">
			<section class="panel" id="shop-panel">
				<h2>Shop <span style="font-weight:normal;font-size:.6rem" id="shop-hint"></span></h2>
				<div id="shop-empty" class="muted">No shop generated. Click "New Shop".</div>
				<div id="shop-container" style="display:none">
					<table class="shop"><thead><tr><th></th><th>Item</th><th>Rarity</th><th>Price (cp)</th></tr></thead><tbody id="shop-body"></tbody></table>
					<div class="actions-grid">
						<label class="inline"><input type="checkbox" id="shop-haggle"/> Haggle</label>
						<label class="inline"><input type="checkbox" id="shop-use-luck"/> Spend Luck</label>
						<button id="shop-buy">Buy Selected</button>
					</div>
				</div>
			</section>
		</div>
		<div class="col">
			<section class="panel">
				<h2>Log</h2>
				<div id="log"></div>
			</section>
		</div>
	</div>
</main>
<script type="module">
import init, { Game } from './pkg/dungeon_core.js';
const el = id=>document.getElementById(id);
const logEl = el('log');
let game; let currentShop = [];
function log(msg){ const ts=new Date().toLocaleTimeString(); logEl.textContent += `[${ts}] ${msg}\n`; logEl.scrollTop = logEl.scrollHeight; }
function renderState(state){
	const invSpan = el('inventoryItems'); invSpan.innerHTML='';
	state.items.forEach(i=>{ const s=document.createElement('span'); s.textContent=i; invSpan.appendChild(s); });
	el('inv-currency').textContent = `GP ${state.gp} | SP ${state.sp} | CP ${state.cp}`;
	el('luck-ind').textContent = state.luck ? 'Luck stored for next relevant action.' : '';
}
function unwrap(result){
	// Result may be either a WasmResult { state, message } or a raw WasmInventory
	if(!result) return;
	if(result.state){
		renderState(result.state);
		if(result.message) log(result.message);
	} else {
		renderState(result);
	}
}
async function start(){
	await init();
	game = new Game();
	unwrap(game.get_state());
	log('Game started');
}
start();
// Core actions
el('act-reset').onclick=()=>unwrap(game.reset());
el('loot-add').onclick=()=>{ const v=el('loot-input').value.trim(); if(!v) return; unwrap(game.add_loot(v)); el('loot-input').value=''; };
el('penalty-apply').onclick=()=>unwrap(game.apply_penalty(7));
el('pp-run').onclick=()=>{ unwrap(game.pickpocket("")); };
el('act-pick').onclick=()=>{ unwrap(game.pickpocket("")); };
el('act-fight').onclick=()=>unwrap(game.fight());
// Shop
el('act-shop-gen').onclick=()=>{ const res=game.generate_shop(); currentShop = res.items; buildShop(); log('Generated new shop stock'); };
function buildShop(){ const empty=el('shop-empty'); const cont=el('shop-container'); const body=el('shop-body'); if(!currentShop||!currentShop.length){ empty.style.display=''; cont.style.display='none'; return;} empty.style.display='none'; cont.style.display=''; body.innerHTML=''; currentShop.forEach(it=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td><input type='checkbox' data-id='${it.id}'></td><td>${it.name}</td><td><span class='tag rar-${it.rarity}'>${it.rarity}</span></td><td>${it.price_cp}</td>`; body.appendChild(tr); }); }
el('shop-buy').onclick=()=>{ const checks=[...document.querySelectorAll('#shop-body input[type=checkbox]:checked')]; if(!checks.length){ log('No items selected'); return; } const ids=checks.map(c=>Number(c.getAttribute('data-id'))); const haggle=el('shop-haggle').checked; const spend=el('shop-use-luck').checked; unwrap(game.shop_purchase(ids, haggle, spend)); };
// Tavern
el('act-tavern').onclick=()=>{ const p=el('tavern-panel'); p.style.display = p.style.display==='none' ? '' : 'none'; };
document.querySelectorAll('#tavern-panel button[data-tv]').forEach(b=>{ b.onclick=()=>{ const act=b.getAttribute('data-tv'); unwrap(game.tavern(act)); }; });
</script>
</body></html>
