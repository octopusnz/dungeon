<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><title>Dungeon (Browser)</title><meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body{font-family:system-ui,Arial,sans-serif;background:#101317;color:#e6e6e6;margin:0;line-height:1.35}
header{background:#181d23;padding:1rem 1.25rem;display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
h1{font-size:1.25rem;margin:0}
main{padding:1rem;max-width:1100px;margin:0 auto}
section.panel{background:#1b222b;border:1px solid #26303a;border-radius:10px;padding:0.75rem 1rem;margin-bottom:1rem}
section.panel h2{font-size:1rem;margin:0 0 .5rem 0;display:flex;justify-content:space-between;align-items:center}
button{background:#2b4b75;color:#fff;border:1px solid #355e91;border-radius:6px;font-size:.85rem;padding:.45rem .8rem;cursor:pointer;line-height:1.1}
button:hover{background:#356294}
button.danger{background:#7b2f2f;border-color:#934040}
button.danger:hover{background:#9b3c3c}
input,textarea,select{background:#141a21;color:#e6e6e6;border:1px solid #2a363f;border-radius:6px;padding:.45rem .6rem;font-size:.8rem;width:100%;box-sizing:border-box}
textarea{resize:vertical;min-height:60px}
fieldset{border:1px solid #2c3742;padding:.5rem  .75rem;border-radius:8px;margin:0 0 .75rem 0}
legend{padding:0 .4rem;font-size:.75rem;letter-spacing:.5px;color:#9cb3c9}
#inventoryItems span{display:inline-block;background:#243241;margin:2px 4px;padding:2px 6px;border-radius:4px;font-size:.7rem}
#log{background:#0f1419;border:1px solid #1f2831;border-radius:8px;padding:.6rem;font-size:.7rem;max-height:260px;overflow:auto;font-family:ui-monospace,monospace;white-space:pre-wrap}
.row{display:flex;flex-wrap:wrap;gap:.75rem}
.col{flex:1 1 260px;min-width:240px}
.currency{font-weight:600;font-size:.8rem;margin-top:.4rem}
.tag{font-size:.55rem;padding:2px 5px;border-radius:4px;background:#334257;margin-left:.4rem;letter-spacing:.5px}
.rar-Epic{background:#5a2f73}.rar-Legendary{background:#7a4d15}.rar-Rare{background:#224f8d}.rar-Uncommon{background:#375d2a}.rar-Common{background:#424d57}
table.shop{width:100%;border-collapse:collapse;font-size:.7rem}
table.shop th,table.shop td{padding:4px 6px;border-bottom:1px solid #26303a;text-align:left}
table.shop tbody tr:hover{background:#1f2831}
.inline{display:inline-flex;align-items:center;gap:.4rem;font-size:.65rem;margin-right:.75rem}
.muted{color:#94a3b8;font-size:.65rem;margin-top:.25rem}
.actions-grid{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.4rem}
/* === Fantasy Theme Overrides (appended) === */
@import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600&family=Cormorant+Garamond:wght@400;500;600&display=swap');
body{font-family:'Cormorant Garamond','Fanwood Text',serif;font-size:17px;background:radial-gradient(circle at 25% 18%,rgba(110,84,42,0.15),transparent 60%),radial-gradient(circle at 82% 72%,rgba(140,95,40,0.12),transparent 70%),linear-gradient(#14181e,#0c0f14 70%);color:#ebe3d5}
header{background:linear-gradient(90deg,#1b222a,#222a33 55%,#1b222a);border-bottom:2px solid #242e37;box-shadow:0 2px 6px rgba(0,0,0,.4)}
h1{font-family:'Cinzel Decorative',cursive;font-size:1.75rem;letter-spacing:.6px;text-shadow:0 0 6px rgba(255,220,140,.25)}
section.panel{background:linear-gradient(145deg,rgba(60,46,34,0.92),rgba(30,22,18,0.92));border:1px solid #3a2f24;border-radius:14px;box-shadow:0 4px 10px rgba(0,0,0,.45),inset 0 0 0 1px rgba(255,255,255,0.04);padding:1rem 1.15rem}
section.panel h2{font:600 1.05rem 'Cinzel',serif;color:#caa75b}
section.panel h2 .icon{width:20px;height:20px;fill:#caa75b;margin-right:.45rem;vertical-align:middle;}
button{background:linear-gradient(145deg,#3f2e21,#2a2019);color:#f5e9d6;border:1px solid #4e3a2b;border-radius:8px;font:600 .85rem 'Cinzel',serif;letter-spacing:.55px;padding:.55rem .95rem}
button .icon{width:18px;height:18px;fill:currentColor;margin-right:.4rem;vertical-align:middle;}
section.panel button{margin-top:.4rem}
button:hover{background:linear-gradient(145deg,#57402d,#3a2b22)}
button.danger{background:linear-gradient(145deg,#5e2323,#401515);border-color:#6d2c2c}
button.danger:hover{background:linear-gradient(145deg,#7b2f2f,#512020)}
#inventoryItems span{background:linear-gradient(145deg,#3a2b22,#281f18);border:1px solid #4e3a2b;border-radius:6px;font-size:.72rem;letter-spacing:.45px}
#log{background:#121517;border:1px solid #313a42;border-radius:10px;padding:.7rem .75rem;font-size:.72rem;max-height:320px;line-height:1.35}
.tag{font-family:'Cinzel',serif;font-size:.65rem;padding:4px 8px;border-radius:6px;min-width:56px;text-align:center}
.rar-Common{background:#55606b;color:#d2d8dd}
.rar-Uncommon{background:#2d6d39;color:#cfe9d2}
.rar-Rare{background:#1d4d8d;color:#c7ddff}
.rar-Epic{background:#6a2f82;color:#f1d4ff}
.rar-Legendary{background:#b07219;color:#ffe9c5}
</style></head><body>
<!-- SVG Sprite Definitions -->
<svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden">
	<symbol id="i-shop" viewBox="0 0 24 24"><path d="M3 9h18l-2 11H5L3 9Zm2.2-6h13.6L21 9H3l2.2-6Zm5.8 9v6h2v-6h-2Z"/></symbol>
	<symbol id="i-reset" viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c2.8 0 5 2.2 5 5a5 5 0 0 1-9 3l-1.6 1.2A7 7 0 0 0 19 12c0-3.9-3.1-7-7-7Z"/></symbol>
	<symbol id="i-pick" viewBox="0 0 24 24"><path d="M4 12c4 0 6-8 9-8 1.7 0 2.8 1.5 2.8 3.2 0 .8-.3 1.6-.8 2.3l-1.2 1.6 3 .7c1.2.3 2.2 1.4 2.2 2.8 0 1.6-1.3 3-3 3H9.5c-2.6 0-4.7-2.1-4.7-4.7V12Z"/></symbol>
	<symbol id="i-fight" viewBox="0 0 24 24"><path d="M7 2 5.6 3.4l4.9 4.9-2.1 2.1L3.4 5.5 2 6.9l5.6 5.6L2 18.2 5.8 22l5.6-5.6L17 22l2.1-2.1-5.6-5.6L22 8.8 18.2 5l-5.6 5.6L7 2Z"/></symbol>
	<symbol id="i-drink" viewBox="0 0 24 24"><path d="M5 3h14l-1 14a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4L5 3Zm2 2 1 12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2l1-12H7Z"/></symbol>
	<symbol id="i-food" viewBox="0 0 24 24"><path d="M4 3h2v7a2 2 0 0 0 2 2v9H6v-7H4V3Zm8 0h2v9h2V3h2v9c0 1.5-1 2.7-2.4 3v9H14v-9a3 3 0 0 1-2-3V3Z"/></symbol>
	<symbol id="i-stay" viewBox="0 0 24 24"><path d="M3 11h18v2H3v-2Zm2-5h8a4 4 0 0 1 4 4H5V6Zm-2 9h18v2H3v-2Z"/></symbol>
	<symbol id="i-tip" viewBox="0 0 24 24"><path d="M12 2c4.4 0 8 2.2 8 5s-3.6 5-8 5-8-2.2-8-5 3.6-5 8-5Zm0 12c2.7 0 5.2-.7 7-1.9v3.4c0 2.8-3.6 5.1-7 5.1s-7-2.3-7-5.1V12.1C6.8 13.3 9.3 14 12 14Z"/></symbol>
	<symbol id="i-flirt" viewBox="0 0 24 24"><path d="M12 21s-6.2-4.6-8.4-8C1.7 10.2 2.4 6.5 5.7 5.2c2-.8 3.9.2 5 1.5 1.1-1.3 3-2.3 5-1.5 3.3 1.3 4 5 2.1 7.8-2.2 3.4-8.4 8-8.4 8Z"/></symbol>
	<symbol id="i-haggle" viewBox="0 0 24 24"><path d="M4 12 2 9l4-6h4l2 3-4 6H4Zm14-9h-4l-2 3 4 6h4l2-3-4-6Zm-7 8h2v10h-2V11Z"/></symbol>
</svg>
<header>
	<h1>Dungeon (Browser)</h1>
	<div class="actions-grid">
		<button id="act-shop-gen"><svg class="icon"><use href="#i-shop"/></svg>New Shop</button>
		<button id="act-reset" class="danger"><svg class="icon"><use href="#i-reset"/></svg>Reset</button>
	</div>
</header>
<main>
	<section class="panel" id="scene-panel" style="padding:.5rem 0 .2rem 0;display:flex;justify-content:center;align-items:center;min-height:200px;overflow:hidden">
		<img id="scene-img" src="assets/scene_pickpocket.svg" alt="Scene" style="max-width:100%;height:auto;filter:drop-shadow(0 0 6px rgba(0,0,0,.6))"/>
	</section>
	<section class="panel" id="inv-panel">
		<h2>Inventory <span id="inv-currency"></span></h2>
		<div id="inventoryItems"></div>
		<div class="muted" id="luck-ind"></div>
	</section>
	<div class="row">
		<div class="col">
			<section class="panel">
				<h2><svg class="icon"><use href="#i-pick"/></svg>Pickpocket</h2>
				<div class="muted" id="pp-info">Random candidate loot is generated each attempt. Stored luck boosts chance of a special event.</div>
				<button id="pp-run"><svg class="icon"><use href="#i-pick"/></svg>Pickpocket</button>
			</section>
			<section class="panel" id="fight-panel">
				<h2><svg class="icon"><use href="#i-fight"/></svg>Fight</h2>
				<div class="muted">Engage a random foe. Victory grants gold; defeat may cost some.</div>
				<button id="fight-run" style="margin-top:.5rem"><svg class="icon"><use href="#i-fight"/></svg>Fight Monster</button>
			</section>
			<section class="panel" id="tavern-panel">
				<h2><svg class="icon"><use href="#i-drink"/></svg>Tavern</h2>
				<div class="muted">Spend coin for modest benefits; rare chances to gain stored luck.</div>
				<div class="actions-grid" style="margin-top:.5rem">
					<button data-tv="drink"><svg class="icon"><use href="#i-drink"/></svg>Drink</button>
					<button data-tv="food"><svg class="icon"><use href="#i-food"/></svg>Food</button>
					<button data-tv="stay"><svg class="icon"><use href="#i-stay"/></svg>Stay</button>
					<button data-tv="tip"><svg class="icon"><use href="#i-tip"/></svg>Tip</button>
					<button data-tv="flirt"><svg class="icon"><use href="#i-flirt"/></svg>Flirt</button>
				</div>
			</section>
		</div>
		<div class="col">
			<section class="panel" id="shop-panel">
				<h2><svg class="icon"><use href="#i-shop"/></svg>Shop <span style="font-weight:normal;font-size:.6rem" id="shop-hint"></span></h2>
				<div id="shop-empty" class="muted">No shop generated. Click "New Shop".</div>
				<div id="shop-container" style="display:none">
					<table class="shop"><thead><tr><th></th><th>Item</th><th>Rarity</th><th>Price (cp)</th></tr></thead><tbody id="shop-body"></tbody></table>
					<div class="actions-grid">
						<label class="inline"><input type="checkbox" id="shop-haggle"/> <svg class="icon"><use href="#i-haggle"/></svg>Haggle</label>
						<label class="inline"><input type="checkbox" id="shop-use-luck"/> Spend Luck</label>
						<button id="shop-buy">Buy Selected</button>
					</div>
				</div>
			</section>
		</div>
		<div class="col">
			<section class="panel">
				<h2>Log</h2>
				<div id="log"></div>
			</section>
		</div>
	</div>
</main>
<script type="module">
import init, { Game } from './pkg/dungeon_core.js';
const el = id=>document.getElementById(id);
const logEl = el('log');
let game; let currentShop = [];
function log(msg){ const ts=new Date().toLocaleTimeString(); logEl.textContent += `[${ts}] ${msg}\n`; logEl.scrollTop = logEl.scrollHeight; }
function renderState(state){
	const invSpan = el('inventoryItems'); invSpan.innerHTML='';
	state.items.forEach(i=>{ const s=document.createElement('span'); s.textContent=i; invSpan.appendChild(s); });
	el('inv-currency').textContent = `GP ${state.gp} | SP ${state.sp} | CP ${state.cp}`;
	el('luck-ind').textContent = state.luck ? 'Luck stored for next relevant action.' : '';
}
function unwrap(result){
	// Result may be either a WasmResult { state, message } or a raw WasmInventory
	if(!result) return;
	if(result.state){
		renderState(result.state);
		if(result.message) log(result.message);
		updateSceneFromMessage(result.message || '');
	} else {
		renderState(result);
	}
}
const scene = el('scene-img');
function setScene(name){
	scene.src = `assets/scene_${name}.svg`;
}
function updateSceneFromMessage(msg){
	const m = msg.toLowerCase();
	if(m.includes('victory') || m.includes('defeated') || m.includes('battle') || m.includes('fight')) setScene('fight');
	else if(m.includes('tavern') || m.includes('drink') || m.includes('meal') || m.includes('tip') || m.includes('kiss')) setScene('tavern');
	else if(m.includes('pickpocket') || m.includes('mysterious')) setScene('pickpocket');
}
async function start(){
	await init();
	game = new Game();
	unwrap(game.get_state());
	log('Game started');
}
start();
// Core actions
el('act-reset').onclick=()=>unwrap(game.reset());
el('pp-run').onclick=()=>{ unwrap(game.pickpocket("")); };
// Fight panel
el('fight-run').onclick=()=>{ unwrap(game.fight()); setScene('fight'); };
// Shop
el('act-shop-gen').onclick=()=>{ const res=game.generate_shop(); currentShop = res.items; buildShop(); log('Generated new shop stock'); };
function buildShop(){ const empty=el('shop-empty'); const cont=el('shop-container'); const body=el('shop-body'); if(!currentShop||!currentShop.length){ empty.style.display=''; cont.style.display='none'; return;} empty.style.display='none'; cont.style.display=''; body.innerHTML=''; currentShop.forEach(it=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td><input type='checkbox' data-id='${it.id}'></td><td>${it.name}</td><td><span class='tag rar-${it.rarity}'>${it.rarity}</span></td><td>${it.price_cp}</td>`; body.appendChild(tr); }); }
el('shop-buy').onclick=()=>{ const checks=[...document.querySelectorAll('#shop-body input[type=checkbox]:checked')]; if(!checks.length){ log('No items selected'); return; } const ids=checks.map(c=>Number(c.getAttribute('data-id'))); const haggle=el('shop-haggle').checked; const spend=el('shop-use-luck').checked; unwrap(game.shop_purchase(ids, haggle, spend)); };
// Tavern buttons
document.querySelectorAll('#tavern-panel button[data-tv]').forEach(b=>{ b.onclick=()=>{ const act=b.getAttribute('data-tv'); unwrap(game.tavern(act)); setScene('tavern'); }; });
</script>
</body></html>
